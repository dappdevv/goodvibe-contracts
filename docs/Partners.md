# Документация: DAOPartners

## Назначение

Контракт DAOPartners реализует 8-уровневую реферальную систему, управление премиум-подпиской, комиссией DAO и процессом верификации пользователей. Все оплаты и распределения осуществляются в нативном токене сети (ETH).

## Основные структуры

- **Partner**: структура партнёра

  - `user` — адрес пользователя
  - `referrer` — адрес реферера (пригласившего)
  - `premium` — дата окончания премиум-подписки

- **VerificationRequest**: заявка на верификацию
  - `id` — уникальный идентификатор заявки
  - `verifiable` — адрес пользователя, проходящего верификацию
  - `verificator` — адрес верификатора
  - `fioHash` — зашифрованная строка ФИО
  - `fioPlain` — ФИО для сравнения (используется только для проверки)
  - `selfie` — ссылка на селфи (IPFS)
  - `key` — ключ шифрования
  - `status` — статус заявки (NONE, AWAITING, VERIFIED, REJECTED)

## Основные функции

- `payPremium(uint8 months)` — оплата премиум-подписки на 1-6 месяцев. Оплата и распределение происходят в ETH. DAO получает комиссию, остальное распределяется по 8-уровневой реферальной цепочке. Если у реферера нет активного премиума, его доля остаётся на контракте.
- `setPremiumPrice(uint256 price)` — установить стоимость премиума (только владелец).
- `setDAOCommission(uint256 commission)` — установить комиссию DAO (только владелец).
- `setTreasury(address treasury)` — установить адрес DAO-казначейства (только владелец).
- `withdraw(address payable to, uint256 amount)` — вывести ETH с контракта (только владелец).
- `registerPartner(address user, address referrer)` — зарегистрировать нового партнёра (только владелец, обычно вызывается при регистрации пользователя).

### Верификация

- `startVerification(string fioPlain, address verificator, string selfie, string key, string fioHash)` — создать заявку на верификацию (пользователь загружает селфи, указывает верификатора и ФИО).
- `getAwaitingVerifications(address user)` — получить список заявок на верификацию, где пользователь является верификатором или верифицируемым.
- `verify(uint256 id, string fioPlain)` — подтвердить верификацию (сравнивается расшифрованное ФИО).
- `rejectVerification(uint256 id)` — отклонить заявку на верификацию.

## События

- `PremiumPaid(address user, uint256 months, uint256 amount, uint256 timestamp)` — премиум оплачен
- `VerificationStarted(uint256 id, address verifiable, address verificator)` — создана заявка на верификацию
- `Verified(uint256 id, address verifiable, address verificator)` — заявка подтверждена
- `VerificationRejected(uint256 id)` — заявка отклонена
- `Withdraw(address to, uint256 amount)` — средства выведены с контракта
- `ParamsChanged(uint256 premiumPrice, uint256 daoCommission)` — изменены параметры премиума или комиссии

## Ограничения и бизнес-логика

- Премиум можно оплатить максимум на 6 месяцев вперёд
- Комиссия DAO — 10% (по умолчанию), остальное распределяется по маркетинг-плану: 1 ур. = 30%, 2 ур. = 20%, 3 ур. = 10%, 4-7 ур. = 5%, 8 ур. = 20%
- Если у реферера нет активного премиума — его доля остаётся на контракте
- Все операции с премиумом и комиссиями происходят в ETH
- Верификация пользователя требует загрузки селфи в IPFS и подтверждения верификатором по ФИО
